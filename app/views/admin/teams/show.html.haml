%h3.page_title
  Team: #{@team.name}

%br
%table.zebra-striped
  %thead
    %tr
      %th Team
      %th
  %tr
    %td
      %b
        Name:
    %td
      = @team.name
      &nbsp;
      = link_to edit_admin_team_path(@team), class: "btn btn-small right" do
        %i.icon-edit
        Rename
  %tr
    %td
      %b
        Owner:
    %td
      = @team.owner.name
      .right
        = link_to "#", class: "btn btn-small change-owner-link" do
          %i.icon-edit
          Change owner

  %tr.change-owner-holder.hide
    %td.bgred
      %b.cred
        New Owner:
    %td.bgred
      = form_for @team, url: admin_team_path(@team) do |f|
        = f.select :owner_id, User.all.map { |user| [user.name, user.id] }, {}, {class: 'chosen'}
        %div
          = f.submit 'Change Owner', class: "btn danger"
          = link_to "Cancel", "#", class: "btn change-owner-cancel-link"

%fieldset
  %legend Members (#{@team.members.count})
  = form_tag add_members_admin_team_path(@team), id: "team_members", class: "bulk_import", method: :post  do
    %table#members_list
      %thead
        %tr
          %th User name
          %th Default project access
          %th Team access
          %th.cred Danger Zone!
      - @team.members.each do |member|
        %tr.member
          %td
            = link_to [:admin, member] do
              = member.name
              %small= "(#{member.email})"
          %td= @team.human_default_projects_access(member)
          %td= @team.admin?(member) ? "Admin" : "Member"
          %td.bgred
            = link_to 'Remove', remove_member_admin_team_path(@team, member_id: member.id), confirm: 'Remove project from team and move to global namespace. Are you sure?', method: :delete, class: "btn danger small"
      %tr
        %td= select_tag :user_ids, options_from_collection_for_select(@users , :id, :name_with_email), multiple: true, data: {placeholder: 'Select users'}, class: 'chosen span5'
        %td= select_tag :default_project_access, options_for_select(Project.access_options), {class: "project-access-select chosen span3" }
        %td
          %span= check_box_tag :group_admin
          %span Admin?
        %td= submit_tag 'Add', class: "btn primary", id: :add_members_to_team

%fieldset
  %legend Projects (#{@team.projects.count})
  = form_tag delegate_projects_admin_team_path(@team), id: "assign_projects", class: "bulk_import", method: :post  do
    %table#projects_list
      %thead
        %tr
          %th Project name
          %th Max access
          %th.cred Danger Zone!
      - @team.projects.each do |project|
        %tr.project
          %td
            = link_to project.name_with_namespace, [:admin, project]
          %td
            %span= @team.human_max_project_access(project)
          %td.bgred
            = link_to 'Relegate', relegate_project_admin_team_path(@team, project_id: project.id), confirm: 'Remove project from team and move to global namespace. Are you sure?', method: :delete, class: "btn danger small"
      %tr
        %td= select_tag :project_ids, options_from_collection_for_select(@projects , :id, :name_with_namespace), multiple: true, data: {placeholder: 'Select projects'}, class: 'chosen span5'
        %td= select_tag :greatest_project_access, options_for_select(Project.access_options), {class: "project-access-select chosen span3" }
        %td= submit_tag 'Add', class: "btn primary", id: :assign_projects_to_team

:javascript
  $(function(){
    var modal = $('.change-owner-holder');
    $('.change-owner-link').bind("click", function(){
      $(this).hide();
      modal.show();
    });
    $('.change-owner-cancel-link').bind("click", function(){
      modal.hide();
      $('.change-owner-link').show();
    })
  })

